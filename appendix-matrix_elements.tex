\section{Matrix elements of $\calc_{nm}(\bfk)$}\label{calc}

\subsection{Matrix elements of $\bfv^\nl_{nm}(\bfk)$}

First we obtain the matrix elements of $\bfv^\nl_{nm}(\bfk)$ by using
the following commutator in a
real-space basis
\begin{eqnarray}\label{cn0}
\bra{\bfR'}[\hat\bfr,\hat V(\hat\bfr,\hat\bfr')]\ket{\bfR}
&=&
\bra{\bfR'}(\hat\bfr\hat V(\hat\bfr,\hat\bfr')
-
\hat V(\hat\bfr,\hat\bfr')\hat\bfr
)
\ket{\bfR}
\nonumber\\
&=&
\int d\bfR''\bra{\bfR'}\hat\bfr\ket{\bfR''}\bra{\bfR''}\hat V(\hat\bfr,\hat\bfr') \ket{\bfR}
-
\int d\bfR''\bra{\bfR'}\hat V(\hat\bfr,\hat\bfr')\ket{\bfR''}\bra{\bfR''}\hat\bfr\ket{\bfR}
\nonumber\\
&=&
\int d\bfR'' \bfR''\gd(\bfR'-\bfR'')
\bra{\bfR''}\hat V(\hat\bfr,\hat\bfr') \ket{\bfR}
-
\int d\bfR''\bra{\bfR'}\hat V(\hat\bfr,\hat\bfr')\ket{\bfR''}\bfR\gd(\bfR''-\bfR)
\nonumber\\
&=&
\bfR'\bra{\bfR'}\hat V(\hat\bfr,\hat\bfr') \ket{\bfR}
-
\bra{\bfR'}\hat V(\hat\bfr,\hat\bfr')\ket{\bfR}\bfR
\nonumber\\
&=&
\bfR'
V(\bfR,\bfR')
-
V(\bfR,\bfR')
\bfR
=
\bfR'
V(\bfR,\bfR')
-
\bfR
 V(\bfR,\bfR')
\nonumber\\
\bra{\bfR'}[\hat V(\hat\bfr,\hat\bfr'),\hat\bfr]\ket{\bfR}
&=&
\bfR
V(\bfR,\bfR')
-
\bfR'
 V(\bfR,\bfR')
\nonumber\\
\bra{\bfR}[\hat V(\hat\bfr,\hat\bfr'),\hat\bfr]\ket{\bfR'}
&=&
\bfR'
V(\bfR,\bfR')
-
\bfR
 V(\bfR,\bfR')
,
\end{eqnarray} 
where we used $\hat\bfr\ket{\bfR}=\bfR\ket{\bfR}$, and
the matrix elements of the non-local operator
$\bra{\bfR'}\hat V(\hat\bfr,\hat\bfr')\ket{\bfR}=V(\bfR,\bfR')$ just a
function, no longer an operator, and thus it commutes with $\bfR$ and $\bfR'$.
Now we distinguish operators and non-operators by the carate symbol,
\verb=^=, on top.
We want to calculate
\begin{eqnarray}\label{cn2}
\bra{n\bfk}[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^a]\ket{m\bfk'}
&=&
\int d\bfr d\bfr'
\bra{n\bfk}
\ket{\bfr}\bra{\bfr}
[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^a]
\ket{\bfr'}\bra{\bfr'}
\ket{m\bfk'}
\nonumber\\
&=&
\int d\bfr d\bfr'
\psi^*_{n\bfk}(\bfr)
(  
r'^a V^\nl(\bfr,\bfr')
-  
r^aV^\nl(\bfr,\bfr')
)
\psi_{m\bfk'}(\bfr')
,
\end{eqnarray}  
where due to the fact that the integrand is periodic in real space,
$\bfk=\bfk'$ where $\bfk$ is restricted to the Brillouin Zone.
In plane waves we have that
\begin{eqnarray}\label{cn3}
\psi_{n\bfk}(\bfr)=\frac{1}{\sqrt{\gO}}
\sum_{\bfK} C_{n\bfk}(\bfK)e^{i(\bfk+\bfK)\cdot\bfr}
,
\end{eqnarray}
where $\gO$ is the volume of the unit cell.
Then,
\begin{eqnarray}\label{cn4}
\bra{n\bfk}[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^a]\ket{m\bfk}
&=&
\frac{1}{\gO}
\sum_{\bfK,\bfK'} 
C^*_{n\bfk}(\bfK) 
C_{m\bfk}(\bfK')
\int d\bfr d\bfr' 
e^{-i(\bfk+\bfK)\cdot \bfr}
 ( 
r'^a V^\nl(\bfr,\bfr')
- 
r^aV^\nl(\bfr,\bfr')
) 
e^{i(\bfk+\bfK')\cdot \bfr'}
.
\nonumber\\
\end{eqnarray} 
Using the following identity 
\begin{eqnarray}\label{cn5}
(\nabla_\bfK+\nabla_\bfK')
\int e^{-i\bfK\cdot\bfr}
V^\nl(\bfr,\bfr')
e^{i\bfK'\cdot\bfr'}
\,d\bfr d\bfr'
&=&
-i
\int e^{-i\bfK\cdot\bfr}
\left(
\bfr
V^\nl(\bfr,\bfr')
-
V^\nl(\bfr,\bfr')
\bfr'
\right)
e^{i\bfK'\cdot\bfr'}
\,d\bfr d\bfr'
\nonumber\\
&=&
i
\int e^{-i\bfK\cdot\bfr}
\left(
\bfr'
V^\nl(\bfr,\bfr')
-
\bfr
 V^\nl(\bfr,\bfr')
\right)
e^{i\bfK'\cdot\bfr'}
\,d\bfr d\bfr'
,
\nonumber\\
\end{eqnarray}
then, we obtain
\begin{eqnarray}\label{cn5}
\bra{n\bfk}[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^a]\ket{m\bfk}
&=&
-\frac{i}{\gO}
\sum_{\bfK,\bfK'}
C^*_{n\bfk}(\bfK)
C_{m\bfk}(\bfK')
(\nabla_{K^\rma}+\nabla_{K'^\rma})
\int e^{-i\bfK\cdot\bfr}
V^\nl(\bfr,\bfr')
e^{i\bfK'\cdot\bfr'}
\,d\bfr d\bfr'
\nonumber\\
&=&
-\frac{i}{\gO}
\sum_{\bfK,\bfK'}
C^*_{n\bfk}(\bfK)
C_{m\bfk}(\bfK')
(\nabla_{K^\rma}+\nabla_{K'^\rma})
\bra{\bfK} 
V^\nl
\ket{\bfK'} 
,
\end{eqnarray}
where
\begin{eqnarray}\label{cn6}
\bra{\bfK} 
V^\nl
\ket{\bfK'} 
=
\int e^{-i\bfK\cdot\bfr}
V^\nl(\bfr,\bfr')
e^{i\bfK'\cdot\bfr'}
\,d\bfr d\bfr'
.
\end{eqnarray}
For fully  separable pseudopotentials in the 
Kleinman-Bylander form,\cite{mottaCMS10,kleinmanPRL82,adolphPRB96}
above matrix elements 
can be readily calculated.\cite{francesco}
Therefore,
\begin{eqnarray}\label{cn8}
\frac{i}{\hbar}
\bra{n\bfk}[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^\rma]\ket{m\bfk'}
=\gd(\bfk-\bfk') \bfv^\nl_{nm}(\bfk)
,
\end{eqnarray}
where $\bfv^\nl_{nm}(\bfk)$ are known quantities.

% From Eq.~\eqref{na_hrdab}, we need to further calculate
% \begin{eqnarray}\label{cn9}
% \frac{1}{i\hbar}
% \bra{n\bfk}
% [\hat r^{\rma},\hat v^{\nl,\rmb}]
% \ket{m\bfk'}
% &=&
% \frac{1}{i\hbar}
% \bra{n\bfk}
% [\hat r_i^{\rma},\hat v^{\nl,\rmb}]
% \ket{m\bfk'}
% +
% \frac{1}{i\hbar}
% \bra{n\bfk}
% [\hat r_e^{\rma},\hat v^{\nl,\rmb}]
% \ket{m\bfk'}
% ,
% \end{eqnarray} 
% from Eq.~\eqref{conmri3} and \eqref{gendev}
% \begin{eqnarray}\label{cn19}
% \bra{n\bfk}[\hat r_i^\rma,\hat v^{\nl,\rmb}]\ket{m\bfk'}
% &=&i\gd(\bfk-\bfk')
% (\hat v^{\nl,\rmb}_{nm})_{;k^\rma}
% \nonumber\\
% &=&
% \gd(\bfk-\bfk')\Big(i\nabla_{k^\rma}
% v^{\nl,\rmb}_{n m}(\bfk)
% +
% v^{\nl,\rmb}_{nm}(\bfk)
% \big(
% \xi^\rma_{nn}(\bfk)
% -
% \xi^\rma_{mm}(\bfk)
% \big)
% \Big)
% ,
% \end{eqnarray} 
% and a similar algebra to that of Eq.~\eqref{na_rep} leads to
% \begin{eqnarray}\label{cn11}
% \bra{n\bfk}[\hat r^{\rma}_e,\hat v^{\nl,\rmb}]\ket{m\bfk'}&=&
% \gd(\bfk-\bfk')
% \bigg(
% \sum_{\ell}
% \bigg(
% \xi^{\rma}_{n\ell}
% v^{\nl,\rmb}_{\ell m}
% -
% v^{\nl,\rmb}_{n\ell}
% \xi^{\rma}_{\ell m}
% \bigg)
% +
% v^{\nl,\rmb}_{nm}(\xi^{\rma}_{mm}
% -
% \xi^{\rma}_{nn}
% )
% \bigg)
% .
% \end{eqnarray}
% Putting these last two equations into Eq.~\eqref{cn9} we get
% \begin{eqnarray}\label{cn12}
% \frac{1}{i\hbar}
% \bra{n\bfk}
% [\hat r^{\rma},\hat v^{\nl,\rmb}]
% \ket{m\bfk'}
% &=&
% \frac{1}{i\hbar}
% \gd(\bfk-\bfk')\bigg(i
% \nabla_{k^\rma}v^{\nl,\rmb}_{n m}
% +
% \sum_{\ell}
% \big(
% \xi^{\rma}_{n\ell}
% v^{\nl,\rmb}_{\ell m}
% -
% v^{\nl,\rmb}_{n\ell}
% \xi^{\rma}_{\ell m}
% \big)
% \bigg)
% .
% \end{eqnarray}
% For $n=m$ above expresion can be evaluated, provided that 
% $\nabla_{k^\rma}v^{\nl,\rmb}_{nn}$ is calculated, which is
% numerically doable. However for $n\ne m$ above expresion involves
% $\xi^\rma_{nn}$ which is not clear how to calculate it! Like wise, the
% generalized derivative is not computable, thus, we
% reached a {\it cul-de-sac}. Therefore, do we have to neglect the
% contribution of $\bfv^\nl$ throughout the calculation?

\subsection{Triple commutator}\label{3com}

We want to calculate
\begin{eqnarray}\label{3.1}
\calt^{\rma\rmb}_{nm}(\bfk)=\frac{1}{i\hbar}
\bra{n\bfk}
[\hat r^{\rma},\hat v^{\nl,\rmb}]
\ket{m\bfk'}\gd(\bfk-\bfk')
=
\frac{1}{\hbar^2}
\bra{n\bfk}
\big[\hat r^{\rma},[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^\rmb]\big]
\ket{m\bfk'}\gd(\bfk-\bfk')
,
\end{eqnarray} 
for which we need the following triple commutator
\begin{eqnarray}\label{3.2}
\big[\hat r^{\rma},[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^\rmb]\big]
=
\big[\hat r^{\rmb},[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^\rma]\big]
,
\end{eqnarray} 
where the r.h.s follows form the Jacobi identity, since $[\hat
r^\rma,\hat r^\rmb]=0$.
 We expand  the triple commutator as,
\begin{eqnarray}\label{3.3}
\big[\hat r^{\rma},[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^\rmb]\big]
&=&
\big[\hat r^{\rma},
\hat V^\nl(\hat\bfr,\hat\bfr')\hat r^\rmb
\big]
-
\big[\hat r^{\rma},
\hat r^\rmb\hat V^\nl(\hat\bfr,\hat\bfr')
\big]
\nonumber\\
&=&
\big[\hat r^{\rma},
\hat V^\nl(\hat\bfr,\hat\bfr')
\big]\hat r^\rmb
-
\hat r^\rmb
\big[\hat r^{\rma},
\hat V^\nl(\hat\bfr,\hat\bfr')
\big]
\nonumber\\
&=&
\hat r^{\rma}
\hat V^\nl(\hat\bfr,\hat\bfr')
\hat r^\rmb
-
\hat V^\nl(\hat\bfr,\hat\bfr')
\hat r^\rma
\hat r^{\rmb}
-
\hat r^\rmb
\hat r^{\rma}
\hat V^\nl(\hat\bfr,\hat\bfr')
+
\hat r^\rmb
\hat V^\nl(\hat\bfr,\hat\bfr')
\hat r^{\rma}
.
\end{eqnarray}
Then,
\begin{eqnarray}\label{3.5}
\frac{1}{\hbar^2}
\bra{n\bfk}
\big[\hat r^{\rma},[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^\rmb]\big]
\ket{m\bfk'}
&=&
\frac{1}{\hbar^2}
\int d\bfr d\bfr'
\bra{n\bfk}
\ket{\bfr}\bra{\bfr}
\big[\hat r^{\rma},[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^\rmb]\big]
\ket{\bfr'}\bra{\bfr'}
\ket{m\bfk'}\gd(\bfk-\bfk')
\nonumber\\
&=&
\frac{1}{\hbar^2}
\int d\bfr d\bfr'
\psi^*_{n\bfk}(\bfr)
\Big(
r^{\rma}
V^\nl(\bfr,\bfr')
r'^\rmb
-
V^\nl(\bfr,\bfr')
r'^\rma
r'^{\rmb}
\nonumber\\
&-&
r^\rmb
r^{\rma}
V^\nl(\bfr,\bfr')
+
 r^\rmb
V^\nl(\bfr,\bfr')
r'^{\rma}
\Big) 
\psi_{m\bfk}(\bfr')
\gd(\bfk-\bfk')
\nonumber\\
&=&
\frac{1}{\hbar^2\gO}
\sum_{\bfK,\bfK'} 
C^*_{n\bfk}(\bfK) 
C_{m\bfk}(\bfK')
\int
d\bfr d\bfr'
 e^{-i\bfK\cdot\bfr}
\Big(
r^{\rma}
V^\nl(\bfr,\bfr')
r'^\rmb
-
V^\nl(\bfr,\bfr')
r'^\rma
r'^{\rmb}
\nonumber\\
&-&
r^\rmb
r^{\rma}
V^\nl(\bfr,\bfr')
+
 r^\rmb
V^\nl(\bfr,\bfr')
r'^{\rma}
\Big) 
 e^{i\bfK'\cdot\bfr'}
\gd(\bfk-\bfk')
.
\end{eqnarray} 
We use the following identity
\begin{eqnarray}\label{3.4}
&&
\Big(
\frac{\partial^2}{\partial K^\rma\partial K'^\rmb}
+
\frac{\partial^2}{\partial K'^\rma\partial K'^\rmb}
+
\frac{\partial^2}{\partial K^\rma\partial K^\rmb}
+
\frac{\partial^2}{\partial K^\rmb\partial K'^\rma}
\Big)
\int
d\bfr d\bfr'
 e^{-i\bfK\cdot\bfr}
V^\nl(\bfr,\bfr')
e^{i\bfK'\cdot\bfr'}
\nonumber\\
&=&
\int d\bfr d\bfr'
 e^{-i\bfK\cdot\bfr}
\Big( 
r^{\rma} 
V^\nl(\bfr,\bfr') 
r'^\rmb
- 
V^\nl(\bfr,\bfr') 
r'^\rma 
r'^{\rmb}
- 
r^\rmb 
r^{\rma} 
V^\nl(\bfr,\bfr')
+
 r^\rmb 
V^\nl(\bfr,\bfr') 
r'^{\rma}
\Big)  
e^{i\bfK'\cdot\bfr'}
\nonumber\\
&=&
\Big(
\frac{\partial^2}{\partial K^\rma\partial K'^\rmb}
+
\frac{\partial^2}{\partial K'^\rma\partial K'^\rmb}
+
\frac{\partial^2}{\partial K^\rma\partial K^\rmb}
+
\frac{\partial^2}{\partial K^\rmb\partial K'^\rma}
\Big)
\bra{\bfK} 
V^\nl
\ket{\bfK'} 
,
\end{eqnarray}
to write
\begin{eqnarray}\label{3.7}
\calt^{\rma\rmb}_{nm}(\bfk)
&=&
\frac{1}{\hbar^2\gO}
\sum_{\bfK,\bfK'} 
C^*_{n\bfk}(\bfK) 
C_{m\bfk}(\bfK')
\Big(
\frac{\partial^2}{\partial K^\rma\partial K'^\rmb}
+
\frac{\partial^2}{\partial K'^\rma\partial K'^\rmb}
+
\frac{\partial^2}{\partial K^\rma\partial K^\rmb}
+
\frac{\partial^2}{\partial K^\rmb\partial K'^\rma}
\Big)
\bra{\bfK} 
V^\nl
\ket{\bfK'} 
\nonumber\\
.
\end{eqnarray} 
The double derivatives with respect to $\bfK$ and $\bfK'$ can be worked out as
it is done to obtain the matrix elements of
$[\hat V^\nl(\hat\bfr,\hat\bfr'),\hat r^\rmb]$, 
Eq.~\eqref{cn5}, 
in the notes of Valerio Olevano,\cite{cual}
and thus we
could have the value of the matrix elements of the triple commutator!

With above results we can proceed to evaluate the matrix elements of $\calc$.
From Eq.~\eqref{na_hrdab}
\begin{eqnarray}\label{na_hrdabn}
\bra{n\bfk}
\calc^{\rma\rmb}
\ket{m\bfk'}
&=&
\bra{n\bfk}
\frac{i\hbar}{m_e}\gd_{ab}
\ket{m\bfk'}
+
\bra{n\bfk}
\frac{1}{i\hbar}[r^{\rma},v^{\nl,\rmb}]
\ket{m\bfk'}
\nonumber\\
\calc^{\rma\rmb}_{nm}(\bfk)
\gd(\bfk-\bfk')
&=&
\gd(\bfk-\bfk')
\Big(
\frac{i\hbar}{m_e}\gd_{ab}\gd_{nm}
+
\calt_{nm}^{\rma\rmb}(\bfk)\big)
\nonumber\\
\calc^{\rma\rmb}_{nm}(\bfk)
=\calc^{\rmb\rma}_{nm}(\bfk)
&=&
\frac{i\hbar}{m_e}\gd_{ab}\gd_{nm}
+
\calt_{nm}^{\rma\rmb}(\bfk)
,
\end{eqnarray}
which is an explicit expression that can be numerically calculated.
